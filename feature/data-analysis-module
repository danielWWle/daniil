python
"""
Data Analysis Module - New feature for Python Git project
Advanced data analysis capabilities using pandas and numpy
"""

import numpy as np
import pandas as pd
from typing import Dict, List, Union
import json

class DataAnalyzer:
    """
    Advanced data analysis tool for statistical operations
    and data visualization preparation
    """
    
    def __init__(self, data_source: str = None):
        self.data_source = data_source
        self.dataset = None
        self.analysis_results = {}
        
    def load_csv_data(self, file_path: str) -> pd.DataFrame:
        """
        Load data from CSV file into pandas DataFrame
        
        Args:
            file_path (str): Path to CSV file
            
        Returns:
            pd.DataFrame: Loaded dataset
        """
        try:
            self.dataset = pd.read_csv(file_path)
            print(f"âœ… Successfully loaded data from {file_path}")
            print(f"ğŸ“Š Dataset shape: {self.dataset.shape}")
            return self.dataset
        except Exception as e:
            print(f"âŒ Error loading data: {e}")
            return None
    
    def generate_sample_data(self, rows: int = 100) -> pd.DataFrame:
        """
        Generate sample dataset for demonstration
        
        Args:
            rows (int): Number of rows to generate
            
        Returns:
            pd.DataFrame: Generated sample data
        """
        np.random.seed(42)
        
        data = {
            'user_id': range(1, rows + 1),
            'age': np.random.randint(18, 65, rows),
            'salary': np.random.normal(50000, 15000, rows).round(2),
            'department': np.random.choice(['IT', 'HR', 'Finance', 'Marketing'], rows),
            'experience_years': np.random.randint(0, 20, rows),
            'performance_score': np.random.uniform(0.5, 1.0, rows).round(3)
        }
        
        self.dataset = pd.DataFrame(data)
        print(f"ğŸ¯ Generated sample dataset with {rows} rows")
        return self.dataset
    
    def basic_statistics(self) -> Dict:
        """
        Calculate basic statistical metrics for numerical columns
        
        Returns:
            Dict: Statistical summary
        """
        if self.dataset is None:
            print("âŒ No dataset loaded. Generate or load data first.")
            return {}
        
        numerical_cols = self.dataset.select_dtypes(include=[np.number]).columns
        
        stats = {}
        for col in numerical_cols:
            stats[col] = {
                'mean': float(self.dataset[col].mean()),
                'median': float(self.dataset[col].median()),
                'std': float(self.dataset[col].std()),
                'min': float(self.dataset[col].min()),
                'max': float(self.dataset[col].max()),
                'count': int(self.dataset[col].count())
            }
        
        self.analysis_results['basic_stats'] = stats
        return stats
    
    def group_analysis(self, group_by: str, target_column: str) -> Dict:
        """
        Analyze data grouped by specific column
        
        Args:
            group_by (str): Column to group by
            target_column (str): Column to analyze
            
        Returns:
            Dict: Grouped analysis results
        """
        if self.dataset is None:
            print("âŒ No dataset loaded.")
            return {}
        
        if group_by not in self.dataset.columns or target_column not in self.dataset.columns:
            print("âŒ Specified columns not found in dataset.")
            return {}
        
        grouped = self.dataset.groupby(group_by)[target_column].agg([
            'count', 'mean', 'std', 'min', 'max'
        ]).round(3)
        
        result = grouped.to_dict()
        self.analysis_results[f'grouped_{group_by}'] = result
        
        print(f"ğŸ“ˆ Grouped analysis by '{group_by}':")
        print(grouped)
        
        return result
    
    def detect_outliers(self, column: str, method: str = 'iqr') -> List[int]:
        """
        Detect outliers in specified column
        
        Args:
            column (str): Column to analyze
            method (str): Method for outlier detection ('iqr' or 'zscore')
            
        Returns:
            List[int]: Indices of outlier rows
        """
        if self.dataset is None or column not in self.dataset.columns:
            return []
        
        data = self.dataset[column]
        
        if method == 'iqr':
            Q1 = data.quantile(0.25)
            Q3 = data.quantile(0.75)
            IQR = Q3 - Q1
            lower_bound = Q1 - 1.5 * IQR
            upper_bound = Q3 + 1.5 * IQR
            outliers = self.dataset[(data < lower_bound) | (data > upper_bound)].index.tolist()
        
        elif method == 'zscore':
            z_scores = np.abs((data - data.mean()) / data.std())
            outliers = self.dataset[z_scores > 3].index.tolist()
        
        print(f"ğŸ” Found {len(outliers)} outliers in '{column}' using {method} method")
        self.analysis_results['outliers'] = outliers
        
        return outliers
    
    def export_results(self, file_path: str = 'analysis_results.json'):
        """
        Export analysis results to JSON file
        
        Args:
            file_path (str): Path for output file
        """
        if not self.analysis_results:
            print("âŒ No analysis results to export.")
            return
        
        try:
            with open(file_path, 'w') as f:
                # Convert numpy types to Python native types for JSON serialization
                def convert_types(obj):
                    if isinstance(obj, (np.integer, np.floating)):
                        return float(obj)
                    elif isinstance(obj, np.ndarray):
                        return obj.tolist()
                    elif isinstance(obj, dict):
                        return {k: convert_types(v) for k, v in obj.items()}
                    elif isinstance(obj, list):
                        return [convert_types(item) for item in obj]
                    return obj
                
                json.dump(convert_types(self.analysis_results), f, indent=2)
            print(f"ğŸ’¾ Analysis results exported to {file_path}")
        except Exception as e:
            print(f"âŒ Error exporting results: {e}")


def demo_data_analysis():
    """
    Demonstration function for the DataAnalyzer class
    """
    print("ğŸš€ Data Analysis Module Demonstration")
    print("=" * 50)
    
    # Initialize analyzer
    analyzer = DataAnalyzer()
    
    # Generate sample data
    print("\n1. Generating sample dataset...")
    dataset = analyzer.generate_sample_data(150)
    print(f"   Columns: {list(dataset.columns)}")
    
    # Basic statistics
    print("\n2. Calculating basic statistics...")
    stats = analyzer.basic_statistics()
    for col, metrics in stats.items():
        print(f"   {col}: mean={metrics['mean']:.2f}, std={metrics['std']:.2f}")
    
    # Group analysis
    print("\n3. Performing group analysis...")
    analyzer.group_analysis('department', 'salary')
    
    # Outlier detection
    print("\n4. Detecting outliers...")
    outliers = analyzer.detect_outliers('salary')
    print(f"   Found {len(outliers)} outliers in salary data")
    
    # Export results
    print("\n5. Exporting results...")
    analyzer.export_results('demo_analysis.json')
    
    print("\nğŸ‰ Data analysis demonstration completed!")


if __name__ == "__main__":
    demo_data_analysis()
